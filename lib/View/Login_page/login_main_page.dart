import 'package:flutter/material.dart';import 'package:get/get.dart';import 'package:loading_animation_widget/loading_animation_widget.dart';import 'package:notificationsystem_mobile/controler/method.dart';import 'package:notificationsystem_mobile/controler/Alerts.dart';import '../../help/Colors.dart';import '../../help/text_style.dart';class LogIn_Main_Page extends StatelessWidget {  final TextEditingController emailController = TextEditingController();  final TextEditingController passwordController = TextEditingController();  final _formKey = GlobalKey<FormState>();  final _formKey1 = GlobalKey<FormState>();  RxBool validatoremailflag = false.obs;  RxBool validatorpassflag = false.obs;  RxBool obscureTextflag = true.obs;  LogIn_Main_Page({super.key});  @override  Widget build(BuildContext context) {    return Scaffold(      body: Stack(        children: [          Container(            padding: const EdgeInsets.all(5),            decoration: BoxDecoration(              gradient: LinearGradient(                colors: [Colorsapp.mainColor, Colorsapp.mainColor],                begin: Alignment.topCenter,                end: Alignment.bottomCenter,              ),            ),            child: SafeArea(              child: Column(                crossAxisAlignment: CrossAxisAlignment.center,                children: [                  Image.asset(                    "photo/logo.png",                    width: MediaQuery.of(context).size.width / 2,                    height: MediaQuery.of(context).size.height / 4,                  ),                  Expanded(                    child: Container(                      decoration: const BoxDecoration(                        color: Colors.white,                        borderRadius: BorderRadius.only(                          topLeft: Radius.circular(40),                          topRight: Radius.circular(40),                        ),                      ),                      padding: const EdgeInsets.symmetric(horizontal: 20),                      child: SingleChildScrollView(                        child: Column(                          // mainAxisAlignment: MainAxisAlignment.spaceEvenly,                          crossAxisAlignment: CrossAxisAlignment.stretch,                          children: [                            const SizedBox(height: 30),                            Center(                              child: Text(                                "تسجيل الدخول",                                style: Text_Style.getstyle(                                    fontsize:                                        MediaQuery.of(context).size.width / 15,                                    ColorText: Colorsapp.mainColor,                                    fontWeight: FontWeight.w700),                              ),                            ),                            const SizedBox(height: 30),                            Form(                              key: _formKey,                              child: Column(                                children: [                                  TextFormField(                                      keyboardType:TextInputType.emailAddress,                                      controller: emailController,                                      style: TextStyle(                                        color: Colorsapp.mainColor,                                        fontSize:                                            MediaQuery.of(context).size.width /                                                20,                                      ),                                      decoration: InputDecoration(                                        labelText: "Email",                                        labelStyle: const TextStyle(                                          color: Colors.grey,                                          fontSize: 18,                                        ),                                        enabledBorder: OutlineInputBorder(                                          borderRadius:                                              BorderRadius.circular(10),                                          borderSide: const BorderSide(                                            color: Colors.grey,                                          ),                                        ),                                        focusedBorder: OutlineInputBorder(                                          borderRadius:                                              BorderRadius.circular(10),                                          borderSide: BorderSide(                                            color: Colorsapp.SecondColor,                                          ),                                        ),                                        disabledBorder: OutlineInputBorder(                                          borderRadius:                                              BorderRadius.circular(10),                                          borderSide: BorderSide(                                            color: Colorsapp.redColor,                                          ),                                        ),                                        errorBorder: OutlineInputBorder(                                          borderRadius:                                              BorderRadius.circular(10),                                          borderSide: BorderSide(                                            color: Colorsapp.redColor,                                          ),                                        ),                                        filled: true,                                        fillColor: Colors.white,                                        contentPadding: const EdgeInsets.symmetric(                                          vertical: 15,                                          horizontal: 20,                                        ),                                      ),                                      validator: (value) {                                        if (value!.isEmpty) {                                          return 'الرجاء إدخال عنوان البريد الإلكتروني';                                        }                                        if (!value.contains('@')) {                                          return 'يرجى إدخال عنوان بريد إلكتروني صالح';                                        }                                      }                                      ),                                ],                              ),                            ),                            const SizedBox(height: 10),                            Form(                              key: _formKey1,                              child: Column(                                children: [                                  Obx(                                     () {                                      return TextFormField(                                        keyboardType:TextInputType.visiblePassword,                                        obscureText: obscureTextflag.value,                                          controller: passwordController,                                          style: TextStyle(                                            color: Colorsapp.mainColor,                                            fontSize:                                                MediaQuery.of(context).size.width /                                                    20,                                          ),                                          decoration: InputDecoration(                                            labelText: "Password",                                            labelStyle: const TextStyle(                                              color: Colors.grey,                                              fontSize: 18,                                            ),                                            enabledBorder: OutlineInputBorder(                                              borderRadius:                                                  BorderRadius.circular(10),                                              borderSide: const BorderSide(                                                color: Colors.grey,                                              ),                                            ),                                            focusedBorder: OutlineInputBorder(                                              borderRadius:                                                  BorderRadius.circular(10),                                              borderSide: BorderSide(                                                color: Colorsapp.SecondColor,                                              ),                                            ),                                            disabledBorder: OutlineInputBorder(                                              borderRadius:                                                  BorderRadius.circular(10),                                              borderSide: BorderSide(                                                color: Colorsapp.redColor,                                              ),                                            ),                                            errorBorder: OutlineInputBorder(                                              borderRadius:                                                  BorderRadius.circular(10),                                              borderSide: BorderSide(                                                color: Colorsapp.redColor,                                              ),                                            ),                                            filled: true,                                            fillColor: Colors.white,                                            contentPadding: const EdgeInsets.symmetric(                                              vertical: 15,                                              horizontal: 20,                                            ),                                            suffixIcon:Obx(                                               () {                                                return IconButton(onPressed: () {                                                  obscureTextflag.value=!obscureTextflag.value;                                                }, icon: Icon(obscureTextflag.value==false?                                                Icons.visibility_off:                                                Icons.visibility,                                                  color: obscureTextflag.value==true?                                                  Colors.blueGrey:Colorsapp.mainColor,                                                ),);                                              }                                            )                                          ),                                          validator: (value) {                                            if (value!.isEmpty) {                                              return 'Please enter an password';                                            }                                            return null;                                          }                                          );                                    }                                  ),                                ],                              ),                            ),                            TextButton(                              onPressed: () {                                Methods.resetPassword(context, emailController.text);                              },                              child: Text(                                'نسيت كلمة المرور ؟',                                textDirection: TextDirection.rtl,                                style: Text_Style.getstyle(                                    fontsize:                                        MediaQuery.of(context).size.width / 25,                                    ColorText: Colorsapp.mainColor,                                    fontWeight: FontWeight.w400),                              ),                            ),                            const SizedBox(height: 30),                              ElevatedButton(                                      onPressed: () async {                                        Methods.LogInflag.value = true;                                        Future.delayed(const Duration(seconds: 2),(){                                          Methods.LogInflag.value = false;                                        });                                        if (_formKey.currentState!.validate() &&                                            _formKey1.currentState!                                                .validate()) {                                          Methods.Stagesfield = "";                                          _formKey.currentState!.save();                                          _formKey1.currentState!.save();                                          Methods.emailExists.value = await Methods.checkEmailExists(emailController.text);                                          if(Methods.emailExists.value==true){                                            await Methods.signInWithEmailPassword(context, email: emailController.text, password: passwordController.text);                                          }                                          else{                                            Alerts.showAlerterror(context, "الطالب غير موجود");                                          }                                        }                                        // Perform login action                                      },                                      style: ElevatedButton.styleFrom(                                        padding:                                            const EdgeInsets.symmetric(vertical: 15),                                        primary: Colorsapp.SecondColor,                                        shape: RoundedRectangleBorder(                                          borderRadius:                                              BorderRadius.circular(20),                                        ),                                      ),                                      child: Text(                                        'تسجيل دخول',                                        style: Text_Style.getstyle(                                            fontsize: MediaQuery.of(context)                                                    .size                                                    .width /                                                20,                                            ColorText: Colorsapp.White,                                            fontWeight: FontWeight.w700),                                      ),                                    ),                        Obx(                           () {                            return Methods.LogInflag==true?Center(                              child: LoadingAnimationWidget.flickr(                                size: 80,                                leftDotColor: Colorsapp.mainColor,                                rightDotColor: Colorsapp.SecondColor,                                //color: Colorsapp.mainColor,                              ),                            ):Container();                          }                        )                          ],                        ),                      ),                    ),                  ),                ],              ),            ),          ),        ],      ),    );  }}